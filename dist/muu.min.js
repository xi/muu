(function(r,p,g){(function(g){"function"===typeof define&&define.amd?define("muu",[],g):r.muu=g(r._)})(function(k){var m={};m["muu-js-helpers"]={instance:k};var v=function(d,c){for(var e=[],a=0;a<d.length;a++)e.push(c(d[a]));return e};k=function(d,c,e){m[d]={deps:c,factory:e}};var t=function(d){if(!m[d])return g;m[d].instance||(m[d].instance=m[d].factory.apply(g,v(m[d].deps,t)));return m[d].instance};k("muu-directive",["muu-dom-helpers","muu-js-helpers","muu-update-dom"],function(d,c,e){return function(a,
b,n){var f=this;a.innerHTML="";var h=function(b){var c=b.currentTarget,h="data-on"+b.type;c.hasAttribute(h)&&(c=c.getAttribute(h),b=d.createEvent("muu-"+c,g,g,b),a.dispatchEvent(b))};this.update=function(l){var u=p.createElement("div");u.innerHTML=n.renderer(b,l);e(a,u);c.forEach(["keydown","keyup","click","change","search"],function(a){c.forEach(f.querySelectorAll("[data-on"+a+"]"),function(b){b.addEventListener(a,h,!1)})});var s=d.createEvent("muu-parent-update");l=this.querySelectorAll("muu.muu-initialised");
c.forEach(l,function(a){a.dispatchEvent(s)});n.linkAll(f)};this.querySelectorAll=function(b){var h=a.querySelectorAll(b),d=a.querySelectorAll(".muu-isolate"),d=c.union(c.map(d,function(a){return a.querySelectorAll(b)}));return c.difference(h,d)};this.querySelector=function(a){a=f.querySelectorAll(a);if(0<a.length)return a[0]};this.getModel=function(a,b){if(a===g){var h={};c.forEach(f.querySelectorAll("[name]"),function(a){h[a.name]=f.getModel(a.name)});return h}var e=f.querySelector("[name="+a+"]");
return e===g?b:"number"===e.getAttribute("type")?parseFloat(e.value,10):"checkbox"===e.getAttribute("type")?e.checked:"radio"===e.getAttribute("type")?(e=f.querySelectorAll("[name="+a+"]"),d.getRadio(e)||b):e.value};this.setModel=function(a,b){var c=f.querySelector("[name="+a+"]");"checkbox"===c.getAttribute("type")?c.checked=b:"radio"===c.getAttribute("type")?(c=f.querySelectorAll("[name="+a+"]"),d.setRadio(c,b)):c.value=b}}});k("muu-dom-helpers",["muu-js-helpers"],function(d){var c={"&":"&amp;",
"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},e={DELAY:1E3,escapeHtml:function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return c[a]})},createEvent:function(a,b,c,d){if("function"===typeof CustomEvent)return new CustomEvent(a,{detail:d,bubbles:b,cancelable:c});var h=p.createEvent("CustomEvent");h.initCustomEvent(a,b,c,d);return h},on:function(a,b,c){a.addEventListener(b,c,!1);return function(){a.removeEventListener(b,c,!1)}},ready:function(a){a=d.once(a);if("complete"===
p.readyState)return a(),function(){};var b=e.on(p,"DOMContentLoaded",a),c=e.on(r,"load",a);return function(){b();c()}},isDescendant:function(a,b){return!!a&&(a===b||e.isDescendant(a.parentNode,b))},destroy:function(a,b){var c;if(r.MutationObserver){var f=new MutationObserver(function(){e.isDescendant(a,p)||(b(),c())});f.observe(p,{childList:!0,subtree:!0});c=d.once(function(){f.disconnect();f=g})}else{var h=setInterval(function(){e.isDescendant(a,p)||(b(),c())},e.DELAY);c=function(){clearInterval(h)}}return c},
getRadio:function(a){for(var b=0;b<a.length;b++)if(a[b].checked)return a[b].value},setRadio:function(a,b){d.forEach(a,function(a){a.checked=a.value===b?!0:!1})}};return e});k("muu-js-helpers",[],function(){var d={isString:function(c){return"string"===typeof c||"[object String]"===Object.prototype.toString.call(c)}};d.isArray=Array.isArray;d.isFunction=function(c){return"function"===typeof c};d.once=function(c){var d,a=!1;return function(){a||(d=c.apply(this,arguments),a=!0);return d}};d.indexOf=function(c,
d){if("indexOf"in c)return c.indexOf(d);for(var a=c.length,b=0;b<a;b++)if(c[b]===d)return b;return-1};d.forEach=function(c,d){if("forEach"in c)return c.forEach(d);for(var a=c.length,b=0;b<a;b++)d(c[b],b,c)};d.map=function(c,e){if("map"in c)return c.map(e);var a=[];d.forEach(c,function(b){a.push(e(b))});return a};d.filter=function(c,e){if("filter"in c)return c.filter(e);var a=[];d.forEach(c,function(b){e(b)&&a.push(b)});return a};d.union=function(c){var e=[];d.forEach(c,function(a){d.forEach(a,function(a){-1===
d.indexOf(e,a)&&e.push(a)})});return e};d.difference=function(c,e){for(var a=[],b=0;b<c.length;b++)-1===d.indexOf(e,c[b])&&a.push(c[b]);return a};d.flatten=function(c){var e=[];d.forEach(c,function(a){d.isArray(a)?e=e.concat(d.flatten(a)):e.push(a)});return e};return d});k("muu-location",["muu-search"],function(d){var c={absUrl:function(){return location.href},url:function(a,b){if(a===g)return location.pathname+location.search+location.hash;b?history.replaceState(null,null,a):history.pushState(null,
null,a);return c},protocol:function(){return location.protocol},host:function(){return location.host},port:function(){return location.port},path:function(a,b){if(a===g)return location.pathname;c.url(a+location.search+location.hash,b);return c}},e=function(a,b){if(a===g)return location.search;a&&"?"!==a[0]&&(a="?"+a);1===a.length&&(a="");c.url(location.pathname+a+location.hash,b);return c};c.search=function(a,b,c){if(a!==g){if(b!==g){var f=d.parse(e());f[a]=b;return e(d.unparse(f),c)}return e(d.unparse(a),
c)}return d.parse(e())};c.hash=function(a,b){if(a===g)return location.hash?location.hash.slice(1):"";c.url(location.pathname+location.search+"#"+a,b);return c};c.addEventListener=function(a,b){"change"===a&&r.addEventListener("popstate",b,!1);return c};c.removeEventListener=function(a,b){"change"===a&&r.removeEventListener("popstate",b,!1);return c};return c});k("muu-registry",["muu-template","muu-directive","muu-js-helpers","muu-dom-helpers"],function(d,c,e,a){return function(b){var n=this,f={};
this.config=b||{};this.renderer=n.config.renderer||d;this.registerDirective=function(a,b,c){f[a]={template:b,link:c};return n};this.registerModule=function(a){a(n);return n};this.link=function(b,d){d===g&&(d=b.getAttribute("type"));if(!f.hasOwnProperty(d))throw Error("Unknown directive type: "+d);var e=f[d].link,s=new c(b,f[d].template,n),e=e(s,b);b.classList.add("muu-isolate");b.classList.add("muu-initialised");n.config.debug&&(b.directive=s);e!==g&&a.destroy(b,e);return s};this.linkAll=function(a){a=
e.filter(a.querySelectorAll("muu"),function(a){return!a.classList.contains("muu-initialised")});return e.map(a,function(a){return n.link(a)})}}});k("muu-search",["muu-js-helpers"],function(d){var c={parse:function(a){var b={},c=function(a,c){b.hasOwnProperty(a)?d.isArray(b[a])?b[a].push(c):b[a]=[b[a],c]:b[a]=c};d.forEach(a.substring(1).split("&"),function(a){a=d.map(a.split("="),decodeURIComponent);2===a.length?c(a[0],a[1]):a[0]&&c(a[0],!0)});return b}},e=function(a,b){return b===g||null===b||!1===
b?[]:d.isArray(b)?d.flatten(d.map(b,function(b){return e(a,b)})):!0===b?[encodeURIComponent(a)]:[encodeURIComponent(a)+"="+encodeURIComponent(b)]};c.unparse=function(a){if(d.isString(a))return a;var b=[],c;for(c in a)a.hasOwnProperty(c)&&(b=b.concat(e(c,a[c])));return 0<b.length?"?"+b.join("&"):""};return c});k("muu-template",["muu-js-helpers","muu-dom-helpers"],function(d,c){var e=function(a,b){return"this"===a?b:b[a]},a=function(a){if(-1===a.indexOf(":"))return function(b){return c.escapeHtml(e(a,
b)||"")};var b=d.map(a.split(","),function(a){var b=a.split(":");a=b[0].trim();b=b.slice(1).join(":").trim();return[a,b]});return function(a){var h=d.map(d.filter(b,function(b){return e(b[1],a)}),function(a){return a[0]});return c.escapeHtml(h.join(" "))}},b=function(a,b,c){var f=n(b,a);return{render:function(b){var l=e(a,b),g="";c?l||(g+=f.render(b)):d.isArray(l)?d.forEach(l,function(a){g+=f.render(a)}):l&&(g+=f.render(b));return g},afterBlock:f.afterBlock}},n=function(c,d){var e=c.indexOf("{{");
if(-1===e){if(d===g)return{render:function(){return c},afterBlock:""};throw Error("unclosed loop: "+d);}var f=c.slice(0,e),q=c.slice(e),k=q.indexOf("}}");if(-1===k)throw Error("unclosed tag: "+q);var e=q.slice(2,k),q=q.slice(k+2),k=!0,m={render:function(){return""},afterBlock:q};if(0===e.lastIndexOf("#",0))m=b(e.substr(1),q);else if(0===e.lastIndexOf("^",0))m=b(e.substr(1),q,!0);else if(0===e.lastIndexOf("/",0)){if(k=!1,e.substr(1)!==d)throw Error("unexpected closing loop: "+e);}else 0!==e.lastIndexOf("!",
0)&&(m.render=a(e));if(k){var p=n(m.afterBlock,d);return{render:function(a){return f+m.render(a)+p.render(a)},afterBlock:p.afterBlock}}return{render:function(a){return f+m.render(a)},afterBlock:m.afterBlock}},f={};return function(a,b){f[a]===g&&(f[a]=n(a));return f[a].render(b)}});k("muu-update-dom",["muu-js-helpers"],function(d){var c=function(a,b){var c=d.map(a.attributes,function(a){return a.name}),e=d.map(b.attributes,function(a){return a.name});d.forEach(c,function(c){b.hasAttribute(c)||"__IE8__"===
c.substr(0,7)||a.removeAttribute(c)});d.forEach(e,function(c){a.getAttribute(c)!==b.getAttribute(c)&&a.setAttribute(c,b.getAttribute(c))})},e=function(a,b){for(var g=a.childNodes.length,f=b.childNodes.length,h=f;h<g;h++)a.removeChild(a.childNodes[f]);for(h=g;h<f;h++)a.appendChild(b.childNodes[g]);for(h=0;h<g&&h<f;h++){var l=a.childNodes[h],k=b.childNodes[h];if(l.nodeType===k.nodeType&&l.nodeName===k.nodeName&&l.type===k.type){if(1===l.nodeType){var m=d.filter(l.classList,function(a){return 0===a.lastIndexOf("muu-",
0)});c(l,k);d.forEach(m,function(a){l.classList.add(a)})}else 3===l.nodeType&&(l.nodeValue=k.nodeValue);3===l.nodeType||l.classList.contains("muu-isolate")||e(l,k)}else l.parentNode.replaceChild(k,l)}};return e});k("muu",["muu-registry","muu-dom-helpers","muu-location"],function(d,c,e){var a={};a.Registry=d;a.$=c;a.$location=e;return a});return t("muu")})})(window,document,void 0);
