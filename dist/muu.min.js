(function(r,p,h){(function(h){"function"===typeof define&&define.amd?define("muu",[],h):r.muu=h(r._)})(function(m){var n={};n["muu-js-helpers"]={instance:m};var v=function(c,b){for(var e=[],a=0;a<c.length;a++)e.push(b(c[a]));return e};m=function(c,b,e){n[c]={deps:b,factory:e}};var t=function(c){if(!n[c])return h;n[c].instance||(n[c].instance=n[c].factory.apply(h,v(n[c].deps,t)));return n[c].instance};m("muu-directive",["muu-dom-helpers","muu-js-helpers","muu-update-dom"],function(c,b,e){return function(a,
d,g){var f=this;a.innerHTML="";var l=function(d){var b="data-on"+d.type;d.target.hasAttribute(b)&&(b=d.target.getAttribute(b),d=c.createEvent("muu-"+b,d),a.dispatchEvent(d))};this.update=function(k){var u=p.createElement("div");u.innerHTML=g.renderer(d,k);e(a,u);b.forEach(["keydown","keyup","click","change","search"],function(a){b.forEach(f.querySelectorAll("[data-on"+a+"]"),function(d){d.addEventListener(a,l,!1)})});var s=c.createEvent("muu-parent-update");k=this.querySelectorAll("muu.muu-initialised");
b.forEach(k,function(a){a.dispatchEvent(s)});g.linkAll(f)};this.querySelectorAll=function(d){var l=a.querySelectorAll(d),c=a.querySelectorAll(".muu-isolate"),c=b.union(b.map(c,function(a){return a.querySelectorAll(d)}));return b.difference(l,c)};this.querySelector=function(a){a=f.querySelectorAll(a);if(0<a.length)return a[0]};this.getModel=function(a,d){if(a===h){var l={};b.forEach(f.querySelectorAll("[name]"),function(a){l[a.name]=f.getModel(a.name)});return l}var e=f.querySelector("[name="+a+"]");
return e===h?d:"checkbox"===e.type?e.checked:"radio"===e.type?(e=f.querySelectorAll("[name="+a+"]"),c.getRadio(e)||d):e.value};this.setModel=function(a,d){var b=f.querySelector("[name="+a+"]");"checkbox"===b.type?b.checked=d:"radio"===b.type?(b=f.querySelectorAll("[name="+a+"]"),c.setRadio(b,d)):b.value=d}}});m("muu-dom-helpers",["muu-js-helpers"],function(c){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},e={DELAY:1E3,escapeHtml:function(a){return String(a).replace(/[&<>"'\/]/g,
function(a){return b[a]})},createEvent:function(a,d){if("function"===typeof CustomEvent)return new CustomEvent(a,{detail:d});var b=p.createEvent("CustomEvent");b.initCustomEvent(a,!1,!0,d);return b},on:function(a,d,b){a.addEventListener(d,b,!1);return function(){a.removeEventListener(d,b,!1)}},ready:function(a){a=c.once(a);if("complete"===p.readyState)return a(),function(){};var d=e.on(p,"DOMContentLoaded",a),b=e.on(r,"load",a);return function(){d();b()}},isDescendant:function(a,d){return!!a&&(a===
d||e.isDescendant(a.parentNode,d))},destroy:function(a,d){var b;if(r.MutationObserver){var f=new MutationObserver(function(){e.isDescendant(a,p)||(d(),b())});f.observe(p,{childList:!0,subtree:!0});b=c.once(function(){f.disconnect();f=h})}else{var l=setInterval(function(){e.isDescendant(a,p)||(d(),b())},e.DELAY);b=function(){clearInterval(l)}}return b},getRadio:function(a){for(var d=0;d<a.length;d++)if(a[d].checked)return a[d].value},setRadio:function(a,d){for(var b=0;b<a.length;b++)a[b].checked=a[b].value===
d?!0:!1}};return e});m("muu-js-helpers",[],function(){var c={isString:function(b){return"string"===typeof b||"[object String]"===Object.prototype.toString.call(b)}};c.isArray=Array.isArray;c.isFunction=function(b){return"function"===typeof b};c.once=function(b){var c,a=!1;return function(){a||(c=b.apply(this,arguments),a=!0);return c}};c.indexOf=function(b,c){if("indexOf"in b)return b.indexOf(c);for(var a=0;a<b.length;a++)if(b[a]===c)return a;return-1};c.forEach=function(b,c){if("forEach"in b)return b.forEach(c);
for(var a=0;a<b.length;a++)c(b[a])};c.map=function(b,c){if("map"in b)return b.map(c);for(var a=[],d=0;d<b.length;d++)a.push(c(b[d]));return a};c.filter=function(b,c){if("filter"in b)return b.filter(c);for(var a=[],d=0;d<b.length;d++)c(b[d])&&a.push(b[d]);return a};c.union=function(b){for(var e=[],a=0;a<b.length;a++)for(var d=0;d<b[a].length;d++)-1===c.indexOf(e,b[a][d])&&e.push(b[a][d]);return e};c.difference=function(b,e){for(var a=[],d=0;d<b.length;d++)-1===c.indexOf(e,b[d])&&a.push(b[d]);return a};
c.flatten=function(b){var e=[];c.forEach(b,function(a){c.isArray(a)?e=e.concat(c.flatten(a)):e.push(a)});return e};return c});m("muu-location",["muu-search"],function(c){var b={absUrl:function(){return location.href},url:function(a,d){if(a===h)return location.pathname+location.search+location.hash;d?history.replaceState(null,null,a):history.pushState(null,null,a);return b},protocol:function(){return location.protocol},host:function(){return location.host},port:function(){return location.port},path:function(a,
d){if(a===h)return location.pathname;b.url(a+location.search+location.hash,d);return b}},e=function(a,d){if(a===h)return location.search;a&&"?"!==a[0]&&(a="?"+a);1===a.length&&(a="");b.url(location.pathname+a+location.hash,d);return b};b.search=function(a,b,g){if(a!==h){if(b!==h){var f=c.parse(e());f[a]=b;return e(c.unparse(f),g)}return e(c.unparse(a),g)}return c.parse(e())};b.hash=function(a,d){if(a===h)return location.hash?location.hash.slice(1):"";b.url(location.pathname+location.search+"#"+a,
d);return b};b.addEventListener=function(a,d){"change"===a&&r.addEventListener("popstate",d,!1);return b};b.removeEventListener=function(a,d){"change"===a&&r.removeEventListener("popstate",d,!1);return b};return b});m("muu-registry",["muu-template","muu-directive","muu-js-helpers","muu-dom-helpers"],function(c,b,e,a){return function(d){var g=this,f={};this.config=d||{};this.renderer=g.config.renderer||c;this.registerDirective=function(a,b,d){f[a]={template:b,link:d};return g};this.registerModule=
function(a){a(g);return g};this.link=function(d,c){c===h&&(c=d.getAttribute("type"));if(!f.hasOwnProperty(c))throw Error("Unknown directive type: "+c);var e=f[c].link,s=new b(d,f[c].template,g),e=e(s,d);d.classList.add("muu-isolate");d.classList.add("muu-initialised");g.config.debug&&(d.directive=s);e!==h&&a.destroy(d,e);return s};this.linkAll=function(a){a=e.filter(a.querySelectorAll("muu"),function(a){return!a.classList.contains("muu-initialised")});return e.map(a,function(a){return g.link(a)})}}});
m("muu-search",["muu-js-helpers"],function(c){var b={parse:function(a){var d={},b=function(a,b){d.hasOwnProperty(a)?c.isArray(d[a])?d[a].push(b):d[a]=[d[a],b]:d[a]=b};c.forEach(a.substring(1).split("&"),function(a){a=c.map(a.split("="),decodeURIComponent);2===a.length?b(a[0],a[1]):a[0]&&b(a[0],!0)});return d}},e=function(a,b){return b===h||null===b||!1===b?[]:c.isArray(b)?c.flatten(c.map(b,function(b){return e(a,b)})):!0===b?[encodeURIComponent(a)]:[encodeURIComponent(a)+"="+encodeURIComponent(b)]};
b.unparse=function(a){if(c.isString(a))return a;var b=[],g;for(g in a)a.hasOwnProperty(g)&&(b=b.concat(e(g,a[g])));return 0<b.length?"?"+b.join("&"):""};return b});m("muu-template",["muu-js-helpers","muu-dom-helpers"],function(c,b){var e=function(a,b){return"this"===a?b:b[a]},a=function(a){if(-1===a.indexOf(":"))return function(d){return b.escapeHtml(e(a,d)||"")};var d=c.map(a.split(","),function(a){var b=a.split(":");a=b[0].trim();b=b.slice(1).join(":").trim();return[a,b]});return function(a){var l=
c.map(c.filter(d,function(b){return e(b[1],a)}),function(a){return a[0]});return b.escapeHtml(l.join(" "))}},d=function(a,b,d){var f=g(b,a);return{render:function(b){var g=e(a,b),k="";if(d)g||(k+=f.render(b));else if(c.isArray(g))for(b=0;b<g.length;b++)k+=f.render(g[b]);else g&&(k+=f.render(b));return k},afterBlock:f.afterBlock}},g=function(b,c){var e=b.indexOf("{{");if(-1===e){if(c===h)return{render:function(){return b},afterBlock:""};throw Error("unclosed loop: "+c);}var f=b.slice(0,e),q=b.slice(e),
m=q.indexOf("}}");if(-1===m)throw Error("unclosed tag: "+q);var e=q.slice(2,m),q=q.slice(m+2),m=!0,n={render:function(){return""},afterBlock:q};if(0===e.lastIndexOf("#",0))n=d(e.substr(1),q);else if(0===e.lastIndexOf("^",0))n=d(e.substr(1),q,!0);else if(0===e.lastIndexOf("/",0)){if(m=!1,e.substr(1)!==c)throw Error("unexpected closing loop: "+e);}else 0!==e.lastIndexOf("!",0)&&(n.render=a(e));if(m){var p=g(n.afterBlock,c);return{render:function(a){return f+n.render(a)+p.render(a)},afterBlock:p.afterBlock}}return{render:function(a){return f+
n.render(a)},afterBlock:n.afterBlock}},f={};return function(a,b){f[a]===h&&(f[a]=g(a));return f[a].render(b)}});m("muu-update-dom",["muu-js-helpers"],function(c){var b=function(a,b){var e=c.map(a.attributes,function(a){return a.name}),f=c.map(b.attributes,function(a){return a.name});c.forEach(e,function(c){b.hasAttribute(c)||"__IE8__"===c.substr(0,7)||a.removeAttribute(c)});c.forEach(f,function(c){a.getAttribute(c)!==b.getAttribute(c)&&a.setAttribute(c,b.getAttribute(c))})},e=function(a,d){for(var g=
a.childNodes.length,f=d.childNodes.length,l=f;l<g;l++)a.removeChild(a.childNodes[f]);for(l=g;l<f;l++)a.appendChild(d.childNodes[g]);for(l=0;l<g&&l<f;l++){var k=a.childNodes[l],h=d.childNodes[l];if(k.nodeType===h.nodeType&&k.nodeName===h.nodeName&&k.type===h.type){if(1===k.nodeType){var m=c.filter(k.classList,function(a){return 0===a.lastIndexOf("muu-",0)});b(k,h);c.forEach(m,function(a){k.classList.add(a)})}else 3===k.nodeType&&(k.nodeValue=h.nodeValue);3===k.nodeType||k.classList.contains("muu-isolate")||
e(k,h)}else k.parentNode.replaceChild(h,k)}};return e});m("muu",["muu-registry","muu-dom-helpers","muu-location"],function(c,b,e){var a={};a.Registry=c;a.$=b;a.$location=e;return a});return t("muu")})})(window,document,void 0);
