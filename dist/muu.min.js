(function(r,p,h){(function(h){"function"===typeof define&&define.amd?define("muu",[],h):r.muu=h(r._)})(function(m){var n={};n["muu-js-helpers"]={instance:m};var v=function(d,b){for(var e=[],a=0;a<d.length;a++)e.push(b(d[a]));return e};m=function(d,b,e){n[d]={deps:b,factory:e}};var t=function(d){if(!n[d])return h;n[d].instance||(n[d].instance=n[d].factory.apply(h,v(n[d].deps,t)));return n[d].instance};m("muu-directive",["muu-dom-helpers","muu-js-helpers","muu-update-dom"],function(d,b,e){return function(a,
c,g){var f=this;a.innerHTML="";var k=function(c){var b=c.currentTarget,k="data-on"+c.type;b.hasAttribute(k)&&(b=b.getAttribute(k),c=d.createEvent("muu-"+b,h,h,c),a.dispatchEvent(c))};this.update=function(l){var u=p.createElement("div");u.innerHTML=g.renderer(c,l);e(a,u);b.forEach(["keydown","keyup","click","change","search"],function(a){b.forEach(f.querySelectorAll("[data-on"+a+"]"),function(c){c.addEventListener(a,k,!1)})});var s=d.createEvent("muu-parent-update");l=this.querySelectorAll("muu.muu-initialised");
b.forEach(l,function(a){a.dispatchEvent(s)});g.linkAll(f)};this.querySelectorAll=function(c){var k=a.querySelectorAll(c),d=a.querySelectorAll(".muu-isolate"),d=b.union(b.map(d,function(a){return a.querySelectorAll(c)}));return b.difference(k,d)};this.querySelector=function(a){a=f.querySelectorAll(a);if(0<a.length)return a[0]};this.getModel=function(a,c){if(a===h){var k={};b.forEach(f.querySelectorAll("[name]"),function(a){k[a.name]=f.getModel(a.name)});return k}var e=f.querySelector("[name="+a+"]");
return e===h?c:"number"===e.getAttribute("type")?parseFloat(e.value,10):"checkbox"===e.getAttribute("type")?e.checked:"radio"===e.getAttribute("type")?(e=f.querySelectorAll("[name="+a+"]"),d.getRadio(e)||c):e.value};this.setModel=function(a,c){var b=f.querySelector("[name="+a+"]");"checkbox"===b.getAttribute("type")?b.checked=c:"radio"===b.getAttribute("type")?(b=f.querySelectorAll("[name="+a+"]"),d.setRadio(b,c)):b.value=c}}});m("muu-dom-helpers",["muu-js-helpers"],function(d){var b={"&":"&amp;",
"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},e={DELAY:1E3,escapeHtml:function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return b[a]})},createEvent:function(a,c,b,e){if("function"===typeof CustomEvent)return new CustomEvent(a,{detail:e,bubbles:c,cancelable:b});var k=p.createEvent("CustomEvent");k.initCustomEvent(a,c,b,e);return k},on:function(a,c,b){a.addEventListener(c,b,!1);return function(){a.removeEventListener(c,b,!1)}},ready:function(a){a=d.once(a);if("complete"===
p.readyState)return a(),function(){};var c=e.on(p,"DOMContentLoaded",a),b=e.on(r,"load",a);return function(){c();b()}},isDescendant:function(a,c){return!!a&&(a===c||e.isDescendant(a.parentNode,c))},destroy:function(a,c){var b;if(r.MutationObserver){var f=new MutationObserver(function(){e.isDescendant(a,p)||(c(),b())});f.observe(p,{childList:!0,subtree:!0});b=d.once(function(){f.disconnect();f=h})}else{var k=setInterval(function(){e.isDescendant(a,p)||(c(),b())},e.DELAY);b=function(){clearInterval(k)}}return b},
getRadio:function(a){for(var c=0;c<a.length;c++)if(a[c].checked)return a[c].value},setRadio:function(a,c){for(var b=0;b<a.length;b++)a[b].checked=a[b].value===c?!0:!1}};return e});m("muu-js-helpers",[],function(){var d={isString:function(b){return"string"===typeof b||"[object String]"===Object.prototype.toString.call(b)}};d.isArray=Array.isArray;d.isFunction=function(b){return"function"===typeof b};d.once=function(b){var e,a=!1;return function(){a||(e=b.apply(this,arguments),a=!0);return e}};d.indexOf=
function(b,e){if("indexOf"in b)return b.indexOf(e);for(var a=0;a<b.length;a++)if(b[a]===e)return a;return-1};d.forEach=function(b,e){if("forEach"in b)return b.forEach(e);for(var a=0;a<b.length;a++)e(b[a])};d.map=function(b,e){if("map"in b)return b.map(e);for(var a=[],c=0;c<b.length;c++)a.push(e(b[c]));return a};d.filter=function(b,e){if("filter"in b)return b.filter(e);for(var a=[],c=0;c<b.length;c++)e(b[c])&&a.push(b[c]);return a};d.union=function(b){for(var e=[],a=0;a<b.length;a++)for(var c=0;c<
b[a].length;c++)-1===d.indexOf(e,b[a][c])&&e.push(b[a][c]);return e};d.difference=function(b,e){for(var a=[],c=0;c<b.length;c++)-1===d.indexOf(e,b[c])&&a.push(b[c]);return a};d.flatten=function(b){var e=[];d.forEach(b,function(a){d.isArray(a)?e=e.concat(d.flatten(a)):e.push(a)});return e};return d});m("muu-location",["muu-search"],function(d){var b={absUrl:function(){return location.href},url:function(a,c){if(a===h)return location.pathname+location.search+location.hash;c?history.replaceState(null,
null,a):history.pushState(null,null,a);return b},protocol:function(){return location.protocol},host:function(){return location.host},port:function(){return location.port},path:function(a,c){if(a===h)return location.pathname;b.url(a+location.search+location.hash,c);return b}},e=function(a,c){if(a===h)return location.search;a&&"?"!==a[0]&&(a="?"+a);1===a.length&&(a="");b.url(location.pathname+a+location.hash,c);return b};b.search=function(a,b,g){if(a!==h){if(b!==h){var f=d.parse(e());f[a]=b;return e(d.unparse(f),
g)}return e(d.unparse(a),g)}return d.parse(e())};b.hash=function(a,c){if(a===h)return location.hash?location.hash.slice(1):"";b.url(location.pathname+location.search+"#"+a,c);return b};b.addEventListener=function(a,c){"change"===a&&r.addEventListener("popstate",c,!1);return b};b.removeEventListener=function(a,c){"change"===a&&r.removeEventListener("popstate",c,!1);return b};return b});m("muu-registry",["muu-template","muu-directive","muu-js-helpers","muu-dom-helpers"],function(d,b,e,a){return function(c){var g=
this,f={};this.config=c||{};this.renderer=g.config.renderer||d;this.registerDirective=function(a,b,c){f[a]={template:b,link:c};return g};this.registerModule=function(a){a(g);return g};this.link=function(c,e){e===h&&(e=c.getAttribute("type"));if(!f.hasOwnProperty(e))throw Error("Unknown directive type: "+e);var d=f[e].link,s=new b(c,f[e].template,g),d=d(s,c);c.classList.add("muu-isolate");c.classList.add("muu-initialised");g.config.debug&&(c.directive=s);d!==h&&a.destroy(c,d);return s};this.linkAll=
function(a){a=e.filter(a.querySelectorAll("muu"),function(a){return!a.classList.contains("muu-initialised")});return e.map(a,function(a){return g.link(a)})}}});m("muu-search",["muu-js-helpers"],function(d){var b={parse:function(a){var c={},b=function(a,b){c.hasOwnProperty(a)?d.isArray(c[a])?c[a].push(b):c[a]=[c[a],b]:c[a]=b};d.forEach(a.substring(1).split("&"),function(a){a=d.map(a.split("="),decodeURIComponent);2===a.length?b(a[0],a[1]):a[0]&&b(a[0],!0)});return c}},e=function(a,b){return b===h||
null===b||!1===b?[]:d.isArray(b)?d.flatten(d.map(b,function(b){return e(a,b)})):!0===b?[encodeURIComponent(a)]:[encodeURIComponent(a)+"="+encodeURIComponent(b)]};b.unparse=function(a){if(d.isString(a))return a;var b=[],g;for(g in a)a.hasOwnProperty(g)&&(b=b.concat(e(g,a[g])));return 0<b.length?"?"+b.join("&"):""};return b});m("muu-template",["muu-js-helpers","muu-dom-helpers"],function(d,b){var e=function(a,b){return"this"===a?b:b[a]},a=function(a){if(-1===a.indexOf(":"))return function(c){return b.escapeHtml(e(a,
c)||"")};var c=d.map(a.split(","),function(a){var b=a.split(":");a=b[0].trim();b=b.slice(1).join(":").trim();return[a,b]});return function(a){var k=d.map(d.filter(c,function(b){return e(b[1],a)}),function(a){return a[0]});return b.escapeHtml(k.join(" "))}},c=function(a,b,c){var f=g(b,a);return{render:function(b){var g=e(a,b),l="";if(c)g||(l+=f.render(b));else if(d.isArray(g))for(b=0;b<g.length;b++)l+=f.render(g[b]);else g&&(l+=f.render(b));return l},afterBlock:f.afterBlock}},g=function(b,e){var d=
b.indexOf("{{");if(-1===d){if(e===h)return{render:function(){return b},afterBlock:""};throw Error("unclosed loop: "+e);}var f=b.slice(0,d),q=b.slice(d),m=q.indexOf("}}");if(-1===m)throw Error("unclosed tag: "+q);var d=q.slice(2,m),q=q.slice(m+2),m=!0,n={render:function(){return""},afterBlock:q};if(0===d.lastIndexOf("#",0))n=c(d.substr(1),q);else if(0===d.lastIndexOf("^",0))n=c(d.substr(1),q,!0);else if(0===d.lastIndexOf("/",0)){if(m=!1,d.substr(1)!==e)throw Error("unexpected closing loop: "+d);}else 0!==
d.lastIndexOf("!",0)&&(n.render=a(d));if(m){var p=g(n.afterBlock,e);return{render:function(a){return f+n.render(a)+p.render(a)},afterBlock:p.afterBlock}}return{render:function(a){return f+n.render(a)},afterBlock:n.afterBlock}},f={};return function(a,b){f[a]===h&&(f[a]=g(a));return f[a].render(b)}});m("muu-update-dom",["muu-js-helpers"],function(d){var b=function(a,b){var e=d.map(a.attributes,function(a){return a.name}),f=d.map(b.attributes,function(a){return a.name});d.forEach(e,function(d){b.hasAttribute(d)||
"__IE8__"===d.substr(0,7)||a.removeAttribute(d)});d.forEach(f,function(d){a.getAttribute(d)!==b.getAttribute(d)&&a.setAttribute(d,b.getAttribute(d))})},e=function(a,c){for(var g=a.childNodes.length,f=c.childNodes.length,k=f;k<g;k++)a.removeChild(a.childNodes[f]);for(k=g;k<f;k++)a.appendChild(c.childNodes[g]);for(k=0;k<g&&k<f;k++){var l=a.childNodes[k],h=c.childNodes[k];if(l.nodeType===h.nodeType&&l.nodeName===h.nodeName&&l.type===h.type){if(1===l.nodeType){var m=d.filter(l.classList,function(a){return 0===
a.lastIndexOf("muu-",0)});b(l,h);d.forEach(m,function(a){l.classList.add(a)})}else 3===l.nodeType&&(l.nodeValue=h.nodeValue);3===l.nodeType||l.classList.contains("muu-isolate")||e(l,h)}else l.parentNode.replaceChild(h,l)}};return e});m("muu",["muu-registry","muu-dom-helpers","muu-location"],function(d,b,e){var a={};a.Registry=d;a.$=b;a.$location=e;return a});return t("muu")})})(window,document,void 0);
