(function(q,l,k){(function(k){"function"===typeof define&&define.amd?define("muu",[],k):q.muu=k(q._)})(function(g){var n={};n["muu-js-helpers"]={instance:g};var t=function(d,c){for(var e=[],a=0;a<d.length;a++)e.push(c(d[a]));return e};g=function(d,c,e){n[d]={deps:c,factory:e}};var s=function(d){if(!n[d])return k;n[d].instance||(n[d].instance=n[d].factory.apply(k,t(n[d].deps,s)));return n[d].instance};g("muu-directive",["muu-dom-helpers","muu-js-helpers"],function(d,c){return function(e,a,b){var h=
this;e.innerHTML="";var f=function(a){var b=a.currentTarget,m="data-on"+a.type;-1!==c.indexOf(h.querySelectorAll("["+m+"]"),b)&&(b=b.getAttribute(m),a=d.createEvent("muu-"+b,k,k,a),e.dispatchEvent(a))};this.update=function(p){b.updateDOM(e,b.renderer(a,p));c.forEach(b.events,function(a){c.forEach(h.querySelectorAll("[data-on"+a+"]"),function(b){b.addEventListener(a,f,!1)})});var r=d.createEvent("muu-parent-update");p=h.querySelectorAll("muu.muu-initialised");c.forEach(p,function(a){a.dispatchEvent(r)});
b.linkAll(h)};this.querySelectorAll=function(a){var b=e.querySelectorAll(a),d=e.querySelectorAll(".muu-isolate"),d=c.union.apply(c,c.map(d,function(b){return b.querySelectorAll(a)}));return c.difference(b,d)};this.querySelector=function(a){a=h.querySelectorAll(a);if(0<a.length)return a[0]};this.on=function(a,b){return d.on(e,"muu-"+a,function(a){return b(a.detail)})};this.getModel=function(a,b){if(a===k){var m={};c.forEach(h.querySelectorAll("[name]"),function(a){m[a.name]=h.getModel(a.name)});return m}var e=
h.querySelector("[name="+a+"]");return e===k?b:"number"===e.getAttribute("type")?parseFloat(e.value):"checkbox"===e.getAttribute("type")?e.checked:"radio"===e.getAttribute("type")?(e=h.querySelectorAll("[name="+a+"]"),d.getRadio(e)||b):e.value};this.setModel=function(a,b){if(h.getModel(a)!==b){var c=h.querySelector("[name="+a+"]");"checkbox"===c.getAttribute("type")?c.checked=b:"radio"===c.getAttribute("type")?(c=h.querySelectorAll("[name="+a+"]"),d.setRadio(c,b)):c.value=b}}}});g("muu-dom-helpers",
["muu-js-helpers"],function(d){var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},e={DELAY:1E3,escapeHtml:function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return c[a]})},createEvent:function(a,b,c,d){if("function"===typeof CustomEvent)return new CustomEvent(a,{detail:d,bubbles:b,cancelable:c});var e=l.createEvent("CustomEvent");e.initCustomEvent(a,b,c,d);return e},on:function(a,b,c){a.addEventListener(b,c,!1);return function(){a.removeEventListener(b,c,!1)}},
ready:function(a){a=d.once(a);if("complete"===l.readyState)return a(),function(){};var b=e.on(l,"DOMContentLoaded",a),c=e.on(q,"load",a);return function(){b();c()}},isDescendant:function(a,b){return!!a&&(a===b||e.isDescendant(a.parentNode,b))},destroy:function(a,b){var c;if(q.MutationObserver){var f=new MutationObserver(function(){e.isDescendant(a,l)||(b(),c())});f.observe(l,{childList:!0,subtree:!0});c=d.once(function(){f.disconnect();f=k})}else{var p=setInterval(function(){e.isDescendant(a,l)||
(b(),c())},e.DELAY);c=function(){clearInterval(p)}}return c},getRadio:function(a){for(var b=0;b<a.length;b++)if(a[b].checked)return a[b].value},setRadio:function(a,b){d.forEach(a,function(a){a.checked=a.value===b?!0:!1})}};return e});g("muu-js-helpers",[],function(){var d={isString:function(c){return"string"===typeof c||"[object String]"===Object.prototype.toString.call(c)}};d.isArray=Array.isArray;d.isFunction=function(c){return"function"===typeof c};d.once=function(c){var d,a=!1;return function(){a||
(d=c.apply(this,arguments),a=!0);return d}};d.indexOf=function(c,d){if("indexOf"in c)return c.indexOf(d);for(var a=c.length,b=0;b<a;b++)if(c[b]===d)return b;return-1};d.forEach=function(c,d){if("forEach"in c)return c.forEach(d);for(var a=c.length,b=0;b<a;b++)d(c[b],b,c)};d.map=function(c,e){if("map"in c)return c.map(e);var a=[];d.forEach(c,function(b){a.push(e(b))});return a};d.filter=function(c,e){if("filter"in c)return c.filter(e);var a=[];d.forEach(c,function(b){e(b)&&a.push(b)});return a};d.union=
function(c){var e=[];d.forEach(arguments,function(a){d.forEach(a,function(a){-1===d.indexOf(e,a)&&e.push(a)})});return e};d.difference=function(c,e){for(var a=[],b=0;b<c.length;b++)-1===d.indexOf(e,c[b])&&a.push(c[b]);return a};d.flatten=function(c){var e=[];d.forEach(c,function(a){d.isArray(a)?e=e.concat(d.flatten(a)):e.push(a)});return e};return d});g("muu-location",["muu-search"],function(d){var c={absUrl:function(){return location.href},url:function(a,b){if(a===k)return location.pathname+location.search+
location.hash;b?history.replaceState(null,null,a):history.pushState(null,null,a);return c},protocol:function(){return location.protocol},host:function(){return location.host},port:function(){return location.port},path:function(a,b){if(a===k)return location.pathname;c.url(a+location.search+location.hash,b);return c}},e=function(a,b){if(a===k)return location.search;a&&"?"!==a[0]&&(a="?"+a);1===a.length&&(a="");c.url(location.pathname+a+location.hash,b);return c};c.search=function(a,b,c){if(a!==k){if(b!==
k){var f=d.parse(e());f[a]=b;return e(d.unparse(f),c)}return e(d.unparse(a),c)}return d.parse(e())};c.hash=function(a,b){if(a===k)return location.hash?location.hash.slice(1):"";c.url(location.pathname+location.search+"#"+a,b);return c};c.addEventListener=function(a,b){"change"===a&&q.addEventListener("popstate",b,!1);return c};c.removeEventListener=function(a,b){"change"===a&&q.removeEventListener("popstate",b,!1);return c};return c});g("muu-registry",["muu-template","muu-update-dom","muu-directive",
"muu-js-helpers","muu-dom-helpers"],function(d,c,e,a,b){return function(h){var f=this,p={};this.config=h||{};this.renderer=f.config.renderer||d;this.updateDOM=f.config.updateDOM||c;this.events=["keydown","keyup","click","change","search"];this.registerDirective=function(a,b,c){p[a]={template:b,link:c};return f};this.registerModule=function(a){a(f);return f};this.link=function(a,c){c===k&&(c=a.getAttribute("type"));if(!p.hasOwnProperty(c))throw Error("Unknown directive type: "+c);var d=p[c].link,h=
new e(a,p[c].template,f),d=d(h,a);a.classList.add("muu-isolate");a.classList.add("muu-initialised");f.config.debug&&(a.directive=h);d!==k&&b.destroy(a,d);return h};this.linkAll=function(b){b=a.filter(b.querySelectorAll("muu"),function(a){return!a.classList.contains("muu-initialised")});return a.map(b,function(a){return f.link(a)})}}});g("muu-search",["muu-js-helpers"],function(d){var c={parse:function(a){var b={},c=function(a,c){b.hasOwnProperty(a)?d.isArray(b[a])?b[a].push(c):b[a]=[b[a],c]:b[a]=
c};d.forEach(a.substring(1).split("&"),function(a){a=d.map(a.split("="),decodeURIComponent);2===a.length?c(a[0],a[1]):a[0]&&c(a[0],!0)});return b}},e=function(a,b){return b===k||null===b||!1===b?[]:d.isArray(b)?d.flatten(d.map(b,function(b){return e(a,b)})):!0===b?[encodeURIComponent(a)]:[encodeURIComponent(a)+"="+encodeURIComponent(b)]};c.unparse=function(a){if(d.isString(a))return a;var b=[],c;for(c in a)a.hasOwnProperty(c)&&(b=b.concat(e(c,a[c])));return 0<b.length?"?"+b.join("&"):""};return c});
g("muu-template",["muu-js-helpers","muu-dom-helpers"],function(d,c){var e=function(a,b){return"this"===a?b:b[a]},a=function(a){if(-1===a.indexOf(":"))return function(b){(b=e(a,b))||0===b||(b="");return c.escapeHtml(b)};var b=d.map(a.split(","),function(a){var b=a.split(":");a=b[0].trim();b=b.slice(1).join(":").trim();return[a,b]});return function(a){var h=d.map(d.filter(b,function(b){return e(b[1],a)}),function(a){return a[0]});return c.escapeHtml(h.join(" "))}},b=function(a,b,c){var f=h(b,a);return{render:function(b){var r=
e(a,b),h="";c?r||(h+=f.render(b)):d.isArray(r)?d.forEach(r,function(a){h+=f.render(a)}):r&&(h+=f.render(b));return h},afterBlock:f.afterBlock}},h=function(c,d){var e=c.indexOf("{{");if(-1===e){if(d===k)return{render:function(){return c},afterBlock:""};throw Error("unclosed loop: "+d);}var f=c.slice(0,e),g=c.slice(e),n=g.indexOf("}}");if(-1===n)throw Error("unclosed tag: "+g);var e=g.slice(2,n),g=g.slice(n+2),n=!0,l={render:function(){return""},afterBlock:g};if(0===e.lastIndexOf("#",0))l=b(e.substr(1),
g);else if(0===e.lastIndexOf("^",0))l=b(e.substr(1),g,!0);else if(0===e.lastIndexOf("/",0)){if(n=!1,e.substr(1)!==d)throw Error("unexpected closing loop: "+e);}else 0!==e.lastIndexOf("!",0)&&(l.render=a(e));if(n){var q=h(l.afterBlock,d);return{render:function(a){return f+l.render(a)+q.render(a)},afterBlock:q.afterBlock}}return{render:function(a){return f+l.render(a)},afterBlock:l.afterBlock}},f={};return function(a,b){f[a]===k&&(f[a]=h(a));return f[a].render(b)}});g("muu-update-dom",["muu-js-helpers"],
function(d){var c=function(a,b){var c=d.filter(a.classList,function(a){return 0===a.lastIndexOf("muu-",0)}),e=d.map(a.attributes,function(a){return a.name}),k=d.map(b.attributes,function(a){return a.name});d.forEach(e,function(c){b.hasAttribute(c)||"__IE8__"===c.substr(0,7)||a.removeAttribute(c)});d.forEach(k,function(c){a.getAttribute(c)!==b.getAttribute(c)&&a.setAttribute(c,b.getAttribute(c))});d.forEach(c,function(b){a.classList.add(b)})},e=function(a,b){for(var d=a.childNodes.length,f=b.childNodes.length,
k=0,g=f;g<d;g++)a.removeChild(a.childNodes[f]);for(g=d;g<f;g++)a.appendChild(b.childNodes[d]);for(g=0;g<d&&g<f;g++){var m=a.childNodes[g],l=b.childNodes[g-k];m.nodeType===l.nodeType&&m.nodeName===l.nodeName&&m.type===l.type?(1===m.nodeType?c(m,l):3===m.nodeType&&(m.nodeValue=l.nodeValue),3===m.nodeType||m.classList.contains("muu-isolate")||e(m,l)):(m.parentNode.replaceChild(l,m),k+=1)}};return function(a,b){var c=l.createElement("div");c.innerHTML=b;e(a,c)}});g("muu",["muu-registry","muu-dom-helpers",
"muu-location"],function(d,c,e){var a={};a.Registry=d;a.$=c;a.$location=e;return a});return s("muu")})})(window,document,void 0);
