(function(r,q,n){(function(k){"object"===typeof module&&"object"===typeof module.exports?module.exports=k(require("lodash")):"function"===typeof define&&define.amd?define("muu",["lodash"],k):r.muu=k(r._)})(function(k){var p={};p["muu-js-helpers"]={instance:k};var t=function(d,f){for(var g=[],a=0;a<d.length;a++)g.push(f(d[a]));return g};k=function(d,f,g){p[d]={deps:f,factory:g}};var s=function(d){if(!p[d])return n;p[d].instance||(p[d].instance=p[d].factory.apply(n,t(p[d].deps,s)));return p[d].instance};
k("muu",["registry","dom-helpers","location"],function(d,f,g){var a={};a.Registry=d;a.$=f;a.$location=g;return a});k("directive",["dom-helpers","js-helpers"],function(d,f){return function(g,a,b){var c=this;g.innerHTML="";var m=function(a){var e=a.currentTarget,h="data-on"+a.type;-1!==f.indexOf(c.querySelectorAll("["+h+"]"),e)&&(e=e.getAttribute(h),a=d.createEvent("muu-"+e,n,n,a),g.dispatchEvent(a))};this.update=function(l){b.updateDOM(g,b.renderer(a,l));f.forEach(b.events,function(e){f.forEach(c.querySelectorAll("[data-on"+
e+"]"),function(a){a.addEventListener(e,m,!1)})});var e=d.createEvent("muu-parent-update");l=c.querySelectorAll("muu.muu-initialised");f.forEach(l,function(a){a.dispatchEvent(e)});b.linkAll(c)};this.querySelectorAll=function(a){var e=g.querySelectorAll(a),h=g.querySelectorAll(".muu-isolate"),h=f.union.apply(f,f.map(h,function(e){return e.querySelectorAll(a)}));return f.difference(e,h)};this.querySelector=function(a){a=c.querySelectorAll(a);if(0<a.length)return a[0]};this.on=function(a,e){return d.on(g,
"muu-"+a,function(a){return e(a.detail)})};this.getModel=function(a,e){if(a===n){var h={};f.forEach(c.querySelectorAll("[name]"),function(a){h[a.name]=c.getModel(a.name)});return h}var b=c.querySelector("[name="+a+"]");return b===n?e:"number"===b.getAttribute("type")?parseFloat(b.value):"checkbox"===b.getAttribute("type")?b.checked:"radio"===b.getAttribute("type")?(b=c.querySelectorAll("[name="+a+"]"),d.getRadio(b)||e):b.value};this.setModel=function(a,e){if(c.getModel(a)!==e){var b=c.querySelector("[name="+
a+"]");"checkbox"===b.getAttribute("type")?b.checked=e:"radio"===b.getAttribute("type")?(b=c.querySelectorAll("[name="+a+"]"),d.setRadio(b,e)):b.value=e}}}});k("dom-helpers",["js-helpers"],function(d){var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},g={DELAY:1E3,escapeHtml:function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return f[a]})},createEvent:function(a,b,c,d){if("function"===typeof CustomEvent)return new CustomEvent(a,{detail:d,bubbles:b,cancelable:c});
var g=q.createEvent("CustomEvent");g.initCustomEvent(a,b,c,d);return g},on:function(a,b,c){a.addEventListener(b,c,!1);return function(){a.removeEventListener(b,c,!1)}},ready:function(a){a=d.once(a);if("complete"===q.readyState)return a(),function(){};var b=g.on(q,"DOMContentLoaded",a),c=g.on(r,"load",a);return function(){b();c()}},isDescendant:function(a,b){return!!a&&(a===b||g.isDescendant(a.parentNode,b))},destroy:function(a,b){var c;if(r.MutationObserver){var f=new MutationObserver(function(){g.isDescendant(a,
q)||(b(),c())});f.observe(q,{childList:!0,subtree:!0});c=d.once(function(){f.disconnect();f=n})}else{var l=setInterval(function(){g.isDescendant(a,q)||(b(),c())},g.DELAY);c=function(){clearInterval(l)}}return c},getRadio:function(a){for(var b=0;b<a.length;b++)if(a[b].checked)return a[b].value},setRadio:function(a,b){d.forEach(a,function(a){a.checked=a.value===b?!0:!1})}};return g});k("registry",["template","update-dom","directive","js-helpers","dom-helpers"],function(d,f,g,a,b){return function(c){var m=
this,l={};this.config=c||{};this.renderer=m.config.renderer||d;this.updateDOM=m.config.updateDOM||f;this.events=["keydown","keyup","click","change","search"];this.registerDirective=function(a,b,c){l[a]={template:b,link:c};return m};this.registerModule=function(a){a(m);return m};this.link=function(a,c){c===n&&(c=a.getAttribute("type"));if(!l.hasOwnProperty(c))throw Error("Unknown directive type: "+c);var d=l[c].link,f=new g(a,l[c].template,m),d=d(f,a);a.classList.add("muu-isolate");a.classList.add("muu-initialised");
m.config.debug&&(a.directive=f);d!==n&&b.destroy(a,d);return f};this.linkAll=function(b){b=a.filter(b.querySelectorAll("muu"),function(a){return!a.classList.contains("muu-initialised")});return a.map(b,function(a){return m.link(a)})}}});k("update-dom",["js-helpers"],function(d){var f=function(a,b){var c=d.filter(a.classList,function(a){return 0===a.lastIndexOf("muu-",0)}),f=d.map(a.attributes,function(a){return a.name}),g=d.map(b.attributes,function(a){return a.name});d.forEach(f,function(c){b.hasAttribute(c)||
"__IE8__"===c.substr(0,7)||a.removeAttribute(c)});d.forEach(g,function(c){a.getAttribute(c)!==b.getAttribute(c)&&a.setAttribute(c,b.getAttribute(c))});d.forEach(c,function(b){a.classList.add(b)})},g=function(a,b){for(var c=a.childNodes.length,d=b.childNodes.length,l=0,e=d;e<c;e++)a.removeChild(a.childNodes[d]);for(e=c;e<d;e++)a.appendChild(b.childNodes[c]);for(e=0;e<c&&e<d;e++){var h=a.childNodes[e],k=b.childNodes[e-l];h.nodeType===k.nodeType&&h.nodeName===k.nodeName&&h.type===k.type?(1===h.nodeType?
f(h,k):3===h.nodeType&&(h.nodeValue=k.nodeValue),3===h.nodeType||h.classList.contains("muu-isolate")||g(h,k)):(h.parentNode.replaceChild(k,h),l+=1)}};return function(a,b){var c=q.createElement("div");c.innerHTML=b;g(a,c)}});return s("muu")})})(window,document,void 0);
